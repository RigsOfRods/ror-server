<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Rigs of Rods Multiplayer Server: SimpleOpt.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>SimpleOpt.h</h1><a href="SimpleOpt_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00172"></a>00172 <span class="preprocessor">#ifndef INCLUDED_SimpleOpt</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span><span class="preprocessor">#define INCLUDED_SimpleOpt</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>
<a name="l00175"></a>00175 
<a name="l00177"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e">00177</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e" title="Error values.">_ESOError</a>
<a name="l00178"></a>00178 {
<a name="l00179"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e47cc2fde6a254a90eda7834f2960f770">00179</a>         <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e47cc2fde6a254a90eda7834f2960f770" title="No error.">SO_SUCCESS</a>          =  0,   
<a name="l00180"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e7cef1b6c4d9a8be0961964e254cc2d6b">00180</a>         <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e7cef1b6c4d9a8be0961964e254cc2d6b">SO_OPT_INVALID</a>      = -1,   
<a name="l00182"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e7a90d467d2a707e85e7229d5eb57a160">00182</a>                                                                 <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e7a90d467d2a707e85e7229d5eb57a160">SO_OPT_MULTIPLE</a>     = -2,   
<a name="l00184"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e1f6909aba96fa3631104179ddb5336df">00184</a>                                                                                                                         <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e1f6909aba96fa3631104179ddb5336df">SO_ARG_INVALID</a>      = -3,   
<a name="l00186"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ea12f0354551a3d265a6cddcd28429c2b">00186</a>                                                                                                                                                                                 <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ea12f0354551a3d265a6cddcd28429c2b">SO_ARG_INVALID_TYPE</a> = -4,   
<a name="l00188"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ed9bd80f048d611b1868618958facc363">00188</a>                                                                                                                                                                                                                                         <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ed9bd80f048d611b1868618958facc363" title="Required argument was not supplied.">SO_ARG_MISSING</a>      = -5,   
<a name="l00189"></a><a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32efa64f2e31ca6b0ee334aa2c8d95fa2ed">00189</a>                                                                                                                                                                                                                                         <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32efa64f2e31ca6b0ee334aa2c8d95fa2ed">SO_ARG_INVALID_DATA</a> = -6,   
<a name="l00191"></a>00191 } <a class="code" href="SimpleOpt_8h.html#fdf5bf76980cdbb6b1a7f639393f6669" title="Error values.">ESOError</a>;
<a name="l00192"></a>00192 
<a name="l00194"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c">00194</a> <span class="keyword">enum</span> <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c" title="Option flags.">_ESOFlags</a>
<a name="l00195"></a>00195 {
<a name="l00196"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655ce9ea56fe015db577ffe3bb4574658db0">00196</a>         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655ce9ea56fe015db577ffe3bb4574658db0">SO_O_EXACT</a>    = 0x0001, 
<a name="l00197"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c5d3e106f732eeec3df25536a7816d019">00197</a>         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c5d3e106f732eeec3df25536a7816d019">SO_O_NOSLASH</a>  = 0x0002, 
<a name="l00199"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c89605372442790f85658886ae4260ebb">00199</a>                                                         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c89605372442790f85658886ae4260ebb">SO_O_SHORTARG</a> = 0x0004, 
<a name="l00201"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655cc9de7ebe415eeaa0e71b2c14bc5e8ea8">00201</a>                                                                                                         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655cc9de7ebe415eeaa0e71b2c14bc5e8ea8">SO_O_CLUMP</a>    = 0x0008, 
<a name="l00203"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c2bf192f65bd1335b9454abb659960b0b">00203</a>                                                                                                                                                         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c2bf192f65bd1335b9454abb659960b0b">SO_O_USEALL</a>   = 0x0010, 
<a name="l00205"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c602621e24cc508e09dff311a58b9cb4c">00205</a>                                                                                                                                                                                                         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c602621e24cc508e09dff311a58b9cb4c">SO_O_NOERR</a>    = 0x0020, 
<a name="l00209"></a><a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c5c614f944bd79b16d6814da57737bc0b">00209</a>                                                                                                                                                                                                                                                         <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c5c614f944bd79b16d6814da57737bc0b">SO_O_PEDANTIC</a> = 0x0040  
<a name="l00213"></a>00213 };
<a name="l00214"></a>00214 
<a name="l00220"></a><a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0">00220</a> <span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0">_ESOArgType</a> {
<a name="l00221"></a><a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0d071a30aefed56a823d5f0f880635e61">00221</a>         <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0d071a30aefed56a823d5f0f880635e61" title="No argument. -o --opt.">SO_NONE</a>,    
<a name="l00222"></a><a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0c762be8c66ab3c9db70dfce826027383">00222</a>         <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0c762be8c66ab3c9db70dfce826027383" title="Required separate argument. -o ARG --opt ARG.">SO_REQ_SEP</a>, 
<a name="l00223"></a><a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0cf1017ce7e594e6cbd0efbc62ac0553e">00223</a>         <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0cf1017ce7e594e6cbd0efbc62ac0553e" title="Required combined argument. -oARG -o=ARG --opt=ARG.">SO_REQ_CMB</a>, 
<a name="l00224"></a><a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0fb3349dfb7ec9bea6917fdf63ce02445">00224</a>         <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0fb3349dfb7ec9bea6917fdf63ce02445" title="Optional combined argument. -o[ARG] -o[=ARG] --opt[=ARG].">SO_OPT</a>,     
<a name="l00225"></a><a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d032cf0e7c28ef8b41be7cdd1c34ccc8f7">00225</a>         <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d032cf0e7c28ef8b41be7cdd1c34ccc8f7" title="Multiple separate arguments. -o ARG1 ARG2 ... --opt ARG1 ARG2 ...">SO_MULTI</a>    
<a name="l00226"></a>00226 } <a class="code" href="SimpleOpt_8h.html#50e7da6846dce876e059a7ddf17f90c1">ESOArgType</a>;
<a name="l00227"></a>00227 
<a name="l00229"></a><a class="code" href="SimpleOpt_8h.html#54fe8f0fbc2c7d8c53c944fffb30b3e9">00229</a> <span class="preprocessor">#define SO_END_OF_OPTIONS   { -1, NULL, SO_NONE }</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>
<a name="l00231"></a>00231 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span><span class="preprocessor"># ifdef _WIN32</span>
<a name="l00233"></a>00233 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;crtdbg.h&gt;</span>
<a name="l00234"></a>00234 <span class="preprocessor">#  define SO_ASSERT(b)  _ASSERTE(b)</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span><span class="preprocessor"># else</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;assert.h&gt;</span>
<a name="l00237"></a>00237 <span class="preprocessor">#  define SO_ASSERT(b)  assert(b)</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span><span class="preprocessor"># endif</span>
<a name="l00239"></a>00239 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00240"></a><a class="code" href="SimpleOpt_8h.html#ef04e770d2ff67119511cf3f134c8eaa">00240</a> <span class="preprocessor"></span><span class="preprocessor"># define SO_ASSERT(b)   </span>
<a name="l00241"></a>00241 <span class="preprocessor">#endif</span>
<a name="l00242"></a>00242 <span class="preprocessor"></span>
<a name="l00243"></a>00243 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00244"></a>00244 <span class="comment">//                              MAIN TEMPLATE CLASS</span>
<a name="l00245"></a>00245 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00246"></a>00246 
<a name="l00248"></a>00248 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00249"></a><a class="code" href="classCSimpleOptTempl.html">00249</a> <span class="keyword">class </span><a class="code" href="classCSimpleOptTempl.html" title="Implementation of the SimpleOpt class.">CSimpleOptTempl</a>
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251 <span class="keyword">public</span>:
<a name="l00253"></a><a class="code" href="structCSimpleOptTempl_1_1SOption.html">00253</a>         <span class="keyword">struct </span><a class="code" href="structCSimpleOptTempl_1_1SOption.html" title="Structure used to define all known options.">SOption</a> {
<a name="l00254"></a><a class="code" href="structCSimpleOptTempl_1_1SOption.html#10837f04451fe178b47f1c956db23964">00254</a>                 <span class="keywordtype">int</span>         <a class="code" href="structCSimpleOptTempl_1_1SOption.html#10837f04451fe178b47f1c956db23964" title="ID to return for this flag. Optional but must be &amp;gt;= 0.">nId</a>;        
<a name="l00255"></a><a class="code" href="structCSimpleOptTempl_1_1SOption.html#0970b705e89df4a164ab49f151948464">00255</a>                 SOCHAR *    <a class="code" href="structCSimpleOptTempl_1_1SOption.html#0970b705e89df4a164ab49f151948464" title="arg string to search for, e.g. &amp;quot;open&amp;quot;, &amp;quot;-&amp;quot;, &amp;quot;-f&amp;quot;, &amp;quot;--file&amp;quot;...">pszArg</a>;     
<a name="l00256"></a>00256                 <span class="comment">// Note that on Windows the slash option marker will be converted</span>
<a name="l00257"></a>00257                 <span class="comment">// to a hyphen so that "-f" will also match "/f".</span>
<a name="l00258"></a><a class="code" href="structCSimpleOptTempl_1_1SOption.html#183ddbb6c06a3578db4dfb26fce16f21">00258</a>                 <a class="code" href="SimpleOpt_8h.html#50e7da6846dce876e059a7ddf17f90c1">ESOArgType</a>  <a class="code" href="structCSimpleOptTempl_1_1SOption.html#183ddbb6c06a3578db4dfb26fce16f21" title="type of argument accepted by this option">nArgType</a>;   
<a name="l00259"></a>00259         };
<a name="l00260"></a>00260 
<a name="l00262"></a><a class="code" href="classCSimpleOptTempl.html#901dd8e44e4b1662dea6991478574517">00262</a>         <a class="code" href="classCSimpleOptTempl.html#901dd8e44e4b1662dea6991478574517" title="Initialize the class. Init() must be called later.">CSimpleOptTempl</a>() { <a class="code" href="classCSimpleOptTempl.html#c6128003920f49b8d3a6485b20d94b7e" title="Initialize the class in preparation for calling Next.">Init</a>(0, NULL, NULL, 0); }
<a name="l00263"></a>00263 
<a name="l00265"></a><a class="code" href="classCSimpleOptTempl.html#743811eb95a173a9208c6a6b77298085">00265</a>         <a class="code" href="classCSimpleOptTempl.html#901dd8e44e4b1662dea6991478574517" title="Initialize the class. Init() must be called later.">CSimpleOptTempl</a>(<span class="keywordtype">int</span> argc, SOCHAR * argv[], <span class="keyword">const</span> <a class="code" href="structCSimpleOptTempl_1_1SOption.html" title="Structure used to define all known options.">SOption</a> * a_rgOptions, <span class="keywordtype">int</span> a_nFlags = 0) {
<a name="l00266"></a>00266                 <a class="code" href="classCSimpleOptTempl.html#c6128003920f49b8d3a6485b20d94b7e" title="Initialize the class in preparation for calling Next.">Init</a>(argc, argv, a_rgOptions, a_nFlags);
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268 
<a name="l00285"></a>00285         <span class="keywordtype">void</span> <a class="code" href="classCSimpleOptTempl.html#c6128003920f49b8d3a6485b20d94b7e" title="Initialize the class in preparation for calling Next.">Init</a>(<span class="keywordtype">int</span> a_argc, SOCHAR * a_argv[], <span class="keyword">const</span> SOption * a_rgOptions, <span class="keywordtype">int</span> a_nFlags = 0);
<a name="l00286"></a>00286 
<a name="l00291"></a><a class="code" href="classCSimpleOptTempl.html#8a1b62c4ae02b7f785f577d66740f2b7">00291</a>         <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCSimpleOptTempl.html#8a1b62c4ae02b7f785f577d66740f2b7" title="Change the current options table during option parsing.">SetOptions</a>(<span class="keyword">const</span> <a class="code" href="structCSimpleOptTempl_1_1SOption.html" title="Structure used to define all known options.">SOption</a> * a_rgOptions) { <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a> = a_rgOptions; }
<a name="l00292"></a>00292 
<a name="l00300"></a><a class="code" href="classCSimpleOptTempl.html#e64fd8b816b6d712e2406591df193d5b">00300</a>         <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCSimpleOptTempl.html#e64fd8b816b6d712e2406591df193d5b" title="Change the current flags during option parsing.">SetFlags</a>(<span class="keywordtype">int</span> a_nFlags) { <a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a> = a_nFlags; }
<a name="l00301"></a>00301 
<a name="l00303"></a><a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f">00303</a>         <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<span class="keywordtype">int</span> a_nFlag)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> (<a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a> &amp; a_nFlag) == a_nFlag; }
<a name="l00304"></a>00304 
<a name="l00320"></a>00320         <span class="keywordtype">bool</span> <a class="code" href="classCSimpleOptTempl.html#c0eef4bbcc3097ff36af89be3c0b820f" title="Advance to the next option if available.">Next</a>();
<a name="l00321"></a>00321 
<a name="l00327"></a><a class="code" href="classCSimpleOptTempl.html#b282afa789ca572e993f775b53e7a243">00327</a>         <span class="keyword">inline</span> <a class="code" href="SimpleOpt_8h.html#fdf5bf76980cdbb6b1a7f639393f6669" title="Error values.">ESOError</a> <a class="code" href="classCSimpleOptTempl.html#b282afa789ca572e993f775b53e7a243" title="Return the last error that occurred.">LastError</a>()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a>; }
<a name="l00328"></a>00328 
<a name="l00333"></a><a class="code" href="classCSimpleOptTempl.html#c284454adf9589b46e40576c9adddc67">00333</a>         <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classCSimpleOptTempl.html#c284454adf9589b46e40576c9adddc67" title="Return the nId value from the options array for the current option.">OptionId</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a>; }
<a name="l00334"></a>00334 
<a name="l00339"></a><a class="code" href="classCSimpleOptTempl.html#0b7dfbdb6fbc647227025ebf4d7abaf8">00339</a>         <span class="keyword">inline</span> SOCHAR * <a class="code" href="classCSimpleOptTempl.html#0b7dfbdb6fbc647227025ebf4d7abaf8" title="Return the pszArg from the options array for the current option.">OptionText</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>; }
<a name="l00340"></a>00340 
<a name="l00346"></a><a class="code" href="classCSimpleOptTempl.html#455eadc6db4b85d1a22e1bdd48f5829b">00346</a>         <span class="keyword">inline</span> SOCHAR * <a class="code" href="classCSimpleOptTempl.html#455eadc6db4b85d1a22e1bdd48f5829b" title="Return the argument for the current option where one exists.">OptionArg</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>; }
<a name="l00347"></a>00347 
<a name="l00360"></a>00360         SOCHAR ** <a class="code" href="classCSimpleOptTempl.html#d0ec3543a8272202a107ddbfee19a09d" title="Validate and return the desired number of arguments.">MultiArg</a>(<span class="keywordtype">int</span> n);
<a name="l00361"></a>00361 
<a name="l00367"></a><a class="code" href="classCSimpleOptTempl.html#967f70058a063805b785e338641a353b">00367</a>         <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classCSimpleOptTempl.html#967f70058a063805b785e338641a353b" title="Returned the number of entries in the Files() array.">FileCount</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#806239dfc432f247fd0013479533d08c">m_argc</a> - <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>; }
<a name="l00368"></a>00368 
<a name="l00374"></a><a class="code" href="classCSimpleOptTempl.html#46ce824ccc3e96e255ca1aaaa2050fc0">00374</a>         <span class="keyword">inline</span> SOCHAR * <a class="code" href="classCSimpleOptTempl.html#46ce824ccc3e96e255ca1aaaa2050fc0" title="Return the specified file argument.">File</a>(<span class="keywordtype">int</span> n)<span class="keyword"> const </span>{
<a name="l00375"></a>00375                 <a class="code" href="SimpleOpt_8h.html#ef04e770d2ff67119511cf3f134c8eaa" title="assertion used to test input data">SO_ASSERT</a>(n &gt;= 0 &amp;&amp; n &lt; <a class="code" href="classCSimpleOptTempl.html#967f70058a063805b785e338641a353b" title="Returned the number of entries in the Files() array.">FileCount</a>());
<a name="l00376"></a>00376                 <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[<a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a> + n];
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378 
<a name="l00380"></a><a class="code" href="classCSimpleOptTempl.html#3d871f7994b96c160280808a38725cb5">00380</a>         <span class="keyword">inline</span> SOCHAR ** <a class="code" href="classCSimpleOptTempl.html#3d871f7994b96c160280808a38725cb5" title="Return the array of files.">Files</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> &amp;<a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[<a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>]; }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="keyword">private</span>:
<a name="l00383"></a>00383         SOCHAR <a class="code" href="classCSimpleOptTempl.html#c43ee4c32540063ae644cbb215a17d0b">PrepareArg</a>(SOCHAR * a_pszString) <span class="keyword">const</span>;
<a name="l00384"></a>00384         <span class="keywordtype">bool</span> <a class="code" href="classCSimpleOptTempl.html#ed9c4aad06a9a50e41fe91c0102044e3">NextClumped</a>();
<a name="l00385"></a>00385         <span class="keywordtype">void</span> <a class="code" href="classCSimpleOptTempl.html#e839959a25abd98b1757d56991536418">ShuffleArg</a>(<span class="keywordtype">int</span> a_nStartIdx, <span class="keywordtype">int</span> a_nCount);
<a name="l00386"></a>00386         <span class="keywordtype">int</span> <a class="code" href="classCSimpleOptTempl.html#90380c291fd14816ac48d6d9f01deb60">LookupOption</a>(<span class="keyword">const</span> SOCHAR * a_pszOption) <span class="keyword">const</span>;
<a name="l00387"></a>00387         <span class="keywordtype">int</span> <a class="code" href="classCSimpleOptTempl.html#06e388266b7e1bd1cbcb08c276fc2cb1">CalcMatch</a>(<span class="keyword">const</span> SOCHAR *a_pszSource, <span class="keyword">const</span> SOCHAR *a_pszTest) <span class="keyword">const</span>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="comment">// Find the '=' character within a string.</span>
<a name="l00390"></a><a class="code" href="classCSimpleOptTempl.html#ab6c7efccff782f9807b9d4c501b139d">00390</a>         <span class="keyword">inline</span> SOCHAR * <a class="code" href="classCSimpleOptTempl.html#ab6c7efccff782f9807b9d4c501b139d">FindEquals</a>(SOCHAR *s)<span class="keyword"> const </span>{
<a name="l00391"></a>00391                 <span class="keywordflow">while</span> (*s &amp;&amp; *s != (SOCHAR)<span class="charliteral">'='</span>) ++s;
<a name="l00392"></a>00392                 <span class="keywordflow">return</span> *s ? s : NULL;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="keyword">private</span>:
<a name="l00396"></a><a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">00396</a>         <span class="keyword">const</span> <a class="code" href="structCSimpleOptTempl_1_1SOption.html" title="Structure used to define all known options.">SOption</a> * <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>;     <span class="comment">// pointer to options table as passed in to soInit()</span>
<a name="l00397"></a><a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">00397</a>         <span class="keywordtype">int</span>             <a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a>;       <span class="comment">// flags for parsing the command line</span>
<a name="l00398"></a><a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">00398</a>         <span class="keywordtype">int</span>             <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>;    <span class="comment">// index of the current option in argv</span>
<a name="l00399"></a><a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">00399</a>         <span class="keywordtype">int</span>             <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a>;     <span class="comment">// id of the current option (or -1 if invalid option)</span>
<a name="l00400"></a><a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">00400</a>         <span class="keywordtype">int</span>             <a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a>;   <span class="comment">// index of the next option to be processed</span>
<a name="l00401"></a><a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">00401</a>         <span class="keywordtype">int</span>             <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>;      <span class="comment">// last unprocessed argument, after this are files</span>
<a name="l00402"></a><a class="code" href="classCSimpleOptTempl.html#806239dfc432f247fd0013479533d08c">00402</a>         <span class="keywordtype">int</span>             <a class="code" href="classCSimpleOptTempl.html#806239dfc432f247fd0013479533d08c">m_argc</a>;          <span class="comment">// argc to process</span>
<a name="l00403"></a><a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">00403</a>         SOCHAR **       <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>;          <span class="comment">// argv (rearranged during processing)</span>
<a name="l00404"></a><a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">00404</a>         SOCHAR *        <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>; <span class="comment">// text of the current option, e.g. "-f" or "--file"</span>
<a name="l00405"></a><a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">00405</a>         SOCHAR *        <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>;  <span class="comment">// argument for the current option, e.g. "c:\blah.txt" (or NULL if no argument)</span>
<a name="l00406"></a><a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">00406</a>         SOCHAR *        <a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>;      <span class="comment">// processing of clumped single character options</span>
<a name="l00407"></a><a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">00407</a>         SOCHAR          <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>[3];    <span class="comment">// extract short option text from clumps and combined arguments</span>
<a name="l00408"></a><a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">00408</a>         <a class="code" href="SimpleOpt_8h.html#fdf5bf76980cdbb6b1a7f639393f6669" title="Error values.">ESOError</a>        <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a>;    <span class="comment">// error status from the last call</span>
<a name="l00409"></a>00409 };
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00412"></a>00412 <span class="comment">//                                  IMPLEMENTATION</span>
<a name="l00413"></a>00413 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00416"></a>00416 <span class="keywordtype">void</span>
<a name="l00417"></a><a class="code" href="classCSimpleOptTempl.html#c6128003920f49b8d3a6485b20d94b7e">00417</a> <a class="code" href="classCSimpleOptTempl.html#c6128003920f49b8d3a6485b20d94b7e" title="Initialize the class in preparation for calling Next.">CSimpleOptTempl&lt;SOCHAR&gt;::Init</a>(
<a name="l00418"></a>00418                                                           <span class="keywordtype">int</span>             a_argc,
<a name="l00419"></a>00419                                                           SOCHAR *        a_argv[],
<a name="l00420"></a>00420                                                           <span class="keyword">const</span> <a class="code" href="structCSimpleOptTempl_1_1SOption.html" title="Structure used to define all known options.">SOption</a> * a_rgOptions,
<a name="l00421"></a>00421                                                           <span class="keywordtype">int</span>             a_nFlags
<a name="l00422"></a>00422                                                           )
<a name="l00423"></a>00423 {
<a name="l00424"></a>00424         <a class="code" href="classCSimpleOptTempl.html#806239dfc432f247fd0013479533d08c">m_argc</a>           = a_argc;
<a name="l00425"></a>00425         <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>       = a_argc;
<a name="l00426"></a>00426         <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>           = a_argv;
<a name="l00427"></a>00427         <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>      = a_rgOptions;
<a name="l00428"></a>00428         <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a>     = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e47cc2fde6a254a90eda7834f2960f770" title="No error.">SO_SUCCESS</a>;
<a name="l00429"></a>00429         <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>     = 0;
<a name="l00430"></a>00430         <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a>      = -1;
<a name="l00431"></a>00431         <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>  = NULL;
<a name="l00432"></a>00432         <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>   = NULL;
<a name="l00433"></a>00433         <a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a>    = (a_nFlags &amp; <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c2bf192f65bd1335b9454abb659960b0b">SO_O_USEALL</a>) ? 0 : 1;
<a name="l00434"></a>00434         <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>[0]     = (SOCHAR)<span class="charliteral">'-'</span>;
<a name="l00435"></a>00435         <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>[2]     = (SOCHAR)<span class="charliteral">'\0'</span>;
<a name="l00436"></a>00436         <a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a>         = a_nFlags;
<a name="l00437"></a>00437         <a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>       = NULL;
<a name="l00438"></a>00438 }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00441"></a>00441 <span class="keywordtype">bool</span>
<a name="l00442"></a><a class="code" href="classCSimpleOptTempl.html#c0eef4bbcc3097ff36af89be3c0b820f">00442</a> <a class="code" href="classCSimpleOptTempl.html#c0eef4bbcc3097ff36af89be3c0b820f" title="Advance to the next option if available.">CSimpleOptTempl&lt;SOCHAR&gt;::Next</a>()
<a name="l00443"></a>00443 {
<a name="l00444"></a>00444         <span class="comment">// process a clumped option string if appropriate</span>
<a name="l00445"></a>00445         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a> &amp;&amp; *<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>) {
<a name="l00446"></a>00446                 <span class="comment">// silently discard invalid clumped option</span>
<a name="l00447"></a>00447                 <span class="keywordtype">bool</span> bIsValid = <a class="code" href="classCSimpleOptTempl.html#ed9c4aad06a9a50e41fe91c0102044e3">NextClumped</a>();
<a name="l00448"></a>00448                 <span class="keywordflow">while</span> (*<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a> &amp;&amp; !bIsValid &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c602621e24cc508e09dff311a58b9cb4c">SO_O_NOERR</a>)) {
<a name="l00449"></a>00449                         bIsValid = <a class="code" href="classCSimpleOptTempl.html#ed9c4aad06a9a50e41fe91c0102044e3">NextClumped</a>();
<a name="l00450"></a>00450                 }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452                 <span class="comment">// return this option if valid or we are returning errors</span>
<a name="l00453"></a>00453                 <span class="keywordflow">if</span> (bIsValid || !<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c602621e24cc508e09dff311a58b9cb4c">SO_O_NOERR</a>)) {
<a name="l00454"></a>00454                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00455"></a>00455                 }
<a name="l00456"></a>00456         }
<a name="l00457"></a>00457         <a class="code" href="SimpleOpt_8h.html#ef04e770d2ff67119511cf3f134c8eaa" title="assertion used to test input data">SO_ASSERT</a>(!<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a> || !*<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>);
<a name="l00458"></a>00458         <a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a> = NULL;
<a name="l00459"></a>00459 
<a name="l00460"></a>00460         <span class="comment">// init for the next option</span>
<a name="l00461"></a>00461         <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>    = <a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a>;
<a name="l00462"></a>00462         <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a>     = -1;
<a name="l00463"></a>00463         <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a> = NULL;
<a name="l00464"></a>00464         <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>  = NULL;
<a name="l00465"></a>00465         <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a>    = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e47cc2fde6a254a90eda7834f2960f770" title="No error.">SO_SUCCESS</a>;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="comment">// find the next option</span>
<a name="l00468"></a>00468         SOCHAR cFirst;
<a name="l00469"></a>00469         <span class="keywordtype">int</span> nTableIdx = -1;
<a name="l00470"></a>00470         <span class="keywordtype">int</span> nOptIdx = <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>;
<a name="l00471"></a>00471         <span class="keywordflow">while</span> (nTableIdx &lt; 0 &amp;&amp; nOptIdx &lt; <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>) {
<a name="l00472"></a>00472                 <span class="comment">// assumed argument</span>
<a name="l00473"></a>00473                 <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a> = <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[nOptIdx];
<a name="l00474"></a>00474                 <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>  = NULL;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476                 <span class="comment">// find this option in the options table</span>
<a name="l00477"></a>00477                 cFirst = <a class="code" href="classCSimpleOptTempl.html#c43ee4c32540063ae644cbb215a17d0b">PrepareArg</a>(<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>);
<a name="l00478"></a>00478                 <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[0] == (SOCHAR)<span class="charliteral">'-'</span>) {
<a name="l00479"></a>00479                         <span class="comment">// find any combined argument string and remove equals sign</span>
<a name="l00480"></a>00480                         <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a> = <a class="code" href="classCSimpleOptTempl.html#ab6c7efccff782f9807b9d4c501b139d">FindEquals</a>(<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>);
<a name="l00481"></a>00481                         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>) {
<a name="l00482"></a>00482                                 *<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>++ = (SOCHAR)<span class="charliteral">'\0'</span>;
<a name="l00483"></a>00483                         }
<a name="l00484"></a>00484                 }
<a name="l00485"></a>00485                 nTableIdx = <a class="code" href="classCSimpleOptTempl.html#90380c291fd14816ac48d6d9f01deb60">LookupOption</a>(<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487                 <span class="comment">// if we didn't find this option but if it is a short form</span>
<a name="l00488"></a>00488                 <span class="comment">// option then we try the alternative forms</span>
<a name="l00489"></a>00489                 <span class="keywordflow">if</span> (nTableIdx &lt; 0
<a name="l00490"></a>00490                         &amp;&amp; !<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>
<a name="l00491"></a>00491                         &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[0] == (SOCHAR)<span class="charliteral">'-'</span>
<a name="l00492"></a>00492                         &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[1]
<a name="l00493"></a>00493                 &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[1] != (SOCHAR)<span class="charliteral">'-'</span>
<a name="l00494"></a>00494                         &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[2])
<a name="l00495"></a>00495                 {
<a name="l00496"></a>00496                         <span class="comment">// test for a short-form with argument if appropriate</span>
<a name="l00497"></a>00497                         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c89605372442790f85658886ae4260ebb">SO_O_SHORTARG</a>)) {
<a name="l00498"></a>00498                                 <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>[1] = <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[1];
<a name="l00499"></a>00499                                 <span class="keywordtype">int</span> nIdx = <a class="code" href="classCSimpleOptTempl.html#90380c291fd14816ac48d6d9f01deb60">LookupOption</a>(<a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>);
<a name="l00500"></a>00500                                 <span class="keywordflow">if</span> (nIdx &gt;= 0
<a name="l00501"></a>00501                                         &amp;&amp; (<a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nIdx].nArgType == <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0cf1017ce7e594e6cbd0efbc62ac0553e" title="Required combined argument. -oARG -o=ARG --opt=ARG.">SO_REQ_CMB</a>
<a name="l00502"></a>00502                                         || <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nIdx].nArgType == <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0fb3349dfb7ec9bea6917fdf63ce02445" title="Optional combined argument. -o[ARG] -o[=ARG] --opt[=ARG].">SO_OPT</a>))
<a name="l00503"></a>00503                                 {
<a name="l00504"></a>00504                                         <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>  = &amp;<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[2];
<a name="l00505"></a>00505                                         <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a> = <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>;
<a name="l00506"></a>00506                                         nTableIdx       = nIdx;
<a name="l00507"></a>00507                                 }
<a name="l00508"></a>00508                         }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510                         <span class="comment">// test for a clumped short-form option string and we didn't</span>
<a name="l00511"></a>00511                         <span class="comment">// match on the short-form argument above</span>
<a name="l00512"></a>00512                         <span class="keywordflow">if</span> (nTableIdx &lt; 0 &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655cc9de7ebe415eeaa0e71b2c14bc5e8ea8">SO_O_CLUMP</a>))  {
<a name="l00513"></a>00513                                 <a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a> = &amp;<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[1];
<a name="l00514"></a>00514                                 ++<a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a>;
<a name="l00515"></a>00515                                 <span class="keywordflow">if</span> (nOptIdx &gt; <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>) {
<a name="l00516"></a>00516                                         <a class="code" href="classCSimpleOptTempl.html#e839959a25abd98b1757d56991536418">ShuffleArg</a>(<a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>, nOptIdx - <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>);
<a name="l00517"></a>00517                                 }
<a name="l00518"></a>00518                                 <span class="keywordflow">return</span> <a class="code" href="classCSimpleOptTempl.html#c0eef4bbcc3097ff36af89be3c0b820f" title="Advance to the next option if available.">Next</a>();
<a name="l00519"></a>00519                         }
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522                 <span class="comment">// The option wasn't found. If it starts with a switch character</span>
<a name="l00523"></a>00523                 <span class="comment">// and we are not suppressing errors for invalid options then it</span>
<a name="l00524"></a>00524                 <span class="comment">// is reported as an error, otherwise it is data.</span>
<a name="l00525"></a>00525                 <span class="keywordflow">if</span> (nTableIdx &lt; 0) {
<a name="l00526"></a>00526                         <span class="keywordflow">if</span> (!<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c602621e24cc508e09dff311a58b9cb4c">SO_O_NOERR</a>) &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[0] == (SOCHAR)<span class="charliteral">'-'</span>) {
<a name="l00527"></a>00527                                 <span class="keywordflow">break</span>;
<a name="l00528"></a>00528                         }
<a name="l00529"></a>00529                         <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>[0] = cFirst;
<a name="l00530"></a>00530                         ++nOptIdx;
<a name="l00531"></a>00531                         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>) {
<a name="l00532"></a>00532                                 *(--<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>) = (SOCHAR)<span class="charliteral">'='</span>;
<a name="l00533"></a>00533                         }
<a name="l00534"></a>00534                 }
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="comment">// end of options</span>
<a name="l00538"></a>00538         <span class="keywordflow">if</span> (nOptIdx &gt;= <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>) {
<a name="l00539"></a>00539                 <span class="keywordflow">if</span> (nOptIdx &gt; <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>) {
<a name="l00540"></a>00540                         <a class="code" href="classCSimpleOptTempl.html#e839959a25abd98b1757d56991536418">ShuffleArg</a>(<a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>, nOptIdx - <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>);
<a name="l00541"></a>00541                 }
<a name="l00542"></a>00542                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00543"></a>00543         }
<a name="l00544"></a>00544         ++<a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         <span class="comment">// get the option id</span>
<a name="l00547"></a>00547         <a class="code" href="SimpleOpt_8h.html#50e7da6846dce876e059a7ddf17f90c1">ESOArgType</a> nArgType = <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0d071a30aefed56a823d5f0f880635e61" title="No argument. -o --opt.">SO_NONE</a>;
<a name="l00548"></a>00548         <span class="keywordflow">if</span> (nTableIdx &lt; 0) {
<a name="l00549"></a>00549                 <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = (<a class="code" href="SimpleOpt_8h.html#fdf5bf76980cdbb6b1a7f639393f6669" title="Error values.">ESOError</a>) nTableIdx; <span class="comment">// error code</span>
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551         <span class="keywordflow">else</span> {
<a name="l00552"></a>00552                 <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a>     = <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nTableIdx].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#10837f04451fe178b47f1c956db23964" title="ID to return for this flag. Optional but must be &amp;gt;= 0.">nId</a>;
<a name="l00553"></a>00553                 <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a> = <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nTableIdx].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#0970b705e89df4a164ab49f151948464" title="arg string to search for, e.g. &amp;quot;open&amp;quot;, &amp;quot;-&amp;quot;, &amp;quot;-f&amp;quot;, &amp;quot;--file&amp;quot;...">pszArg</a>;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555                 <span class="comment">// ensure that the arg type is valid</span>
<a name="l00556"></a>00556                 nArgType = <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nTableIdx].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#183ddbb6c06a3578db4dfb26fce16f21" title="type of argument accepted by this option">nArgType</a>;
<a name="l00557"></a>00557                 <span class="keywordflow">switch</span> (nArgType) {
<a name="l00558"></a>00558 <span class="keywordflow">case</span> <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0d071a30aefed56a823d5f0f880635e61" title="No argument. -o --opt.">SO_NONE</a>:
<a name="l00559"></a>00559         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>) {
<a name="l00560"></a>00560                 <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e1f6909aba96fa3631104179ddb5336df">SO_ARG_INVALID</a>;
<a name="l00561"></a>00561         }
<a name="l00562"></a>00562         <span class="keywordflow">break</span>;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="keywordflow">case</span> <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0c762be8c66ab3c9db70dfce826027383" title="Required separate argument. -o ARG --opt ARG.">SO_REQ_SEP</a>:
<a name="l00565"></a>00565         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>) {
<a name="l00566"></a>00566                 <span class="comment">// they wanted separate args, but we got a combined one, unless</span>
<a name="l00567"></a>00567                 <span class="comment">// we are being pedantic about things, just accept it.</span>
<a name="l00568"></a>00568                 <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c5c614f944bd79b16d6814da57737bc0b">SO_O_PEDANTIC</a>)) {
<a name="l00569"></a>00569                         <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ea12f0354551a3d265a6cddcd28429c2b">SO_ARG_INVALID_TYPE</a>;
<a name="l00570"></a>00570                 }
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572         <span class="comment">// more processing after we shuffle</span>
<a name="l00573"></a>00573         <span class="keywordflow">break</span>;
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <span class="keywordflow">case</span> <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0cf1017ce7e594e6cbd0efbc62ac0553e" title="Required combined argument. -oARG -o=ARG --opt=ARG.">SO_REQ_CMB</a>:
<a name="l00576"></a>00576         <span class="keywordflow">if</span> (!<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>) {
<a name="l00577"></a>00577                 <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ed9bd80f048d611b1868618958facc363" title="Required argument was not supplied.">SO_ARG_MISSING</a>;
<a name="l00578"></a>00578         }
<a name="l00579"></a>00579         <span class="keywordflow">break</span>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="keywordflow">case</span> <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0fb3349dfb7ec9bea6917fdf63ce02445" title="Optional combined argument. -o[ARG] -o[=ARG] --opt[=ARG].">SO_OPT</a>:
<a name="l00582"></a>00582         <span class="comment">// nothing to do</span>
<a name="l00583"></a>00583         <span class="keywordflow">break</span>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 <span class="keywordflow">case</span> <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d032cf0e7c28ef8b41be7cdd1c34ccc8f7" title="Multiple separate arguments. -o ARG1 ARG2 ... --opt ARG1 ARG2 ...">SO_MULTI</a>:
<a name="l00586"></a>00586         <span class="comment">// nothing to do. Caller must now check for valid arguments</span>
<a name="l00587"></a>00587         <span class="comment">// using GetMultiArg()</span>
<a name="l00588"></a>00588         <span class="keywordflow">break</span>;
<a name="l00589"></a>00589                 }
<a name="l00590"></a>00590         }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592         <span class="comment">// shuffle the files out of the way</span>
<a name="l00593"></a>00593         <span class="keywordflow">if</span> (nOptIdx &gt; <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>) {
<a name="l00594"></a>00594                 <a class="code" href="classCSimpleOptTempl.html#e839959a25abd98b1757d56991536418">ShuffleArg</a>(<a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>, nOptIdx - <a class="code" href="classCSimpleOptTempl.html#916dfc3386ebbd4104541d876e6c7774">m_nOptionIdx</a>);
<a name="l00595"></a>00595         }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597         <span class="comment">// we need to return the separate arg if required, just re-use the</span>
<a name="l00598"></a>00598         <span class="comment">// multi-arg code because it all does the same thing</span>
<a name="l00599"></a>00599         <span class="keywordflow">if</span> (nArgType == <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0c762be8c66ab3c9db70dfce826027383" title="Required separate argument. -o ARG --opt ARG.">SO_REQ_SEP</a> &amp;&amp; !<a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a> &amp;&amp; <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> == <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e47cc2fde6a254a90eda7834f2960f770" title="No error.">SO_SUCCESS</a>) {
<a name="l00600"></a>00600                 SOCHAR ** ppArgs = <a class="code" href="classCSimpleOptTempl.html#d0ec3543a8272202a107ddbfee19a09d" title="Validate and return the desired number of arguments.">MultiArg</a>(1);
<a name="l00601"></a>00601                 <span class="keywordflow">if</span> (ppArgs) {
<a name="l00602"></a>00602                         <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a> = *ppArgs;
<a name="l00603"></a>00603                 }
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00610"></a>00610 SOCHAR
<a name="l00611"></a><a class="code" href="classCSimpleOptTempl.html#c43ee4c32540063ae644cbb215a17d0b">00611</a> <a class="code" href="classCSimpleOptTempl.html#c43ee4c32540063ae644cbb215a17d0b">CSimpleOptTempl&lt;SOCHAR&gt;::PrepareArg</a>(
<a name="l00612"></a>00612                                                                         SOCHAR * a_pszString
<a name="l00613"></a>00613                                                                         )<span class="keyword"> const</span>
<a name="l00614"></a>00614 <span class="keyword"></span>{
<a name="l00615"></a>00615 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span>        <span class="comment">// On Windows we can accept the forward slash as a single character</span>
<a name="l00617"></a>00617         <span class="comment">// option delimiter, but it cannot replace the '-' option used to</span>
<a name="l00618"></a>00618         <span class="comment">// denote stdin. On Un*x paths may start with slash so it may not</span>
<a name="l00619"></a>00619         <span class="comment">// be used to start an option.</span>
<a name="l00620"></a>00620         <span class="keywordflow">if</span> (!<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c5d3e106f732eeec3df25536a7816d019">SO_O_NOSLASH</a>)
<a name="l00621"></a>00621                 &amp;&amp; a_pszString[0] == (SOCHAR)<span class="charliteral">'/'</span>
<a name="l00622"></a>00622                 &amp;&amp; a_pszString[1]
<a name="l00623"></a>00623         &amp;&amp; a_pszString[1] != (SOCHAR)<span class="charliteral">'-'</span>)
<a name="l00624"></a>00624         {
<a name="l00625"></a>00625                 a_pszString[0] = (SOCHAR)<span class="charliteral">'-'</span>;
<a name="l00626"></a>00626                 <span class="keywordflow">return</span> (SOCHAR)<span class="charliteral">'/'</span>;
<a name="l00627"></a>00627         }
<a name="l00628"></a>00628 <span class="preprocessor">#endif</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>        <span class="keywordflow">return</span> a_pszString[0];
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00633"></a>00633 <span class="keywordtype">bool</span>
<a name="l00634"></a><a class="code" href="classCSimpleOptTempl.html#ed9c4aad06a9a50e41fe91c0102044e3">00634</a> <a class="code" href="classCSimpleOptTempl.html#ed9c4aad06a9a50e41fe91c0102044e3">CSimpleOptTempl&lt;SOCHAR&gt;::NextClumped</a>()
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636         <span class="comment">// prepare for the next clumped option</span>
<a name="l00637"></a>00637         <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>[1]    = *<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>++;
<a name="l00638"></a>00638         <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a>     = -1;
<a name="l00639"></a>00639         <a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a> = <a class="code" href="classCSimpleOptTempl.html#a9a0b032416674bfb4a21f0667f43831">m_szShort</a>;
<a name="l00640"></a>00640         <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a>  = NULL;
<a name="l00641"></a>00641         <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a>    = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e47cc2fde6a254a90eda7834f2960f770" title="No error.">SO_SUCCESS</a>;
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">// lookup this option, ensure that we are using exact matching</span>
<a name="l00644"></a>00644         <span class="keywordtype">int</span> nSavedFlags = <a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a>;
<a name="l00645"></a>00645         <a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a> = <a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655ce9ea56fe015db577ffe3bb4574658db0">SO_O_EXACT</a>;
<a name="l00646"></a>00646         <span class="keywordtype">int</span> nTableIdx = <a class="code" href="classCSimpleOptTempl.html#90380c291fd14816ac48d6d9f01deb60">LookupOption</a>(<a class="code" href="classCSimpleOptTempl.html#2ebb716f1986ad8f25ddace8edacde90">m_pszOptionText</a>);
<a name="l00647"></a>00647         <a class="code" href="classCSimpleOptTempl.html#6e225d27269e58f5e98c336492842fff">m_nFlags</a> = nSavedFlags;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649         <span class="comment">// unknown option</span>
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (nTableIdx &lt; 0) {
<a name="l00651"></a>00651                 <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = (<a class="code" href="SimpleOpt_8h.html#fdf5bf76980cdbb6b1a7f639393f6669" title="Error values.">ESOError</a>) nTableIdx; <span class="comment">// error code</span>
<a name="l00652"></a>00652                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00653"></a>00653         }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <span class="comment">// valid option</span>
<a name="l00656"></a>00656         <a class="code" href="SimpleOpt_8h.html#50e7da6846dce876e059a7ddf17f90c1">ESOArgType</a> nArgType = <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nTableIdx].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#183ddbb6c06a3578db4dfb26fce16f21" title="type of argument accepted by this option">nArgType</a>;
<a name="l00657"></a>00657         <span class="keywordflow">if</span> (nArgType == <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0d071a30aefed56a823d5f0f880635e61" title="No argument. -o --opt.">SO_NONE</a>) {
<a name="l00658"></a>00658                 <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a> = <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nTableIdx].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#10837f04451fe178b47f1c956db23964" title="ID to return for this flag. Optional but must be &amp;gt;= 0.">nId</a>;
<a name="l00659"></a>00659                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         <span class="keywordflow">if</span> (nArgType == <a class="code" href="SimpleOpt_8h.html#cb58d7c1b9261cd0a245305a292402d0cf1017ce7e594e6cbd0efbc62ac0553e" title="Required combined argument. -oARG -o=ARG --opt=ARG.">SO_REQ_CMB</a> &amp;&amp; *<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>) {
<a name="l00663"></a>00663                 <a class="code" href="classCSimpleOptTempl.html#6207ba31bb7d7f35a5df92f375d25e01">m_nOptionId</a> = <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[nTableIdx].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#10837f04451fe178b47f1c956db23964" title="ID to return for this flag. Optional but must be &amp;gt;= 0.">nId</a>;
<a name="l00664"></a>00664                 <a class="code" href="classCSimpleOptTempl.html#6537bca0e360a428b35817c3910b8770">m_pszOptionArg</a> = <a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>;
<a name="l00665"></a>00665                 <span class="keywordflow">while</span> (*<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>) ++<a class="code" href="classCSimpleOptTempl.html#7106fce51d42ff08c29b4252af6783f8">m_pszClump</a>; <span class="comment">// must point to an empty string</span>
<a name="l00666"></a>00666                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         <span class="comment">// invalid option as it requires an argument</span>
<a name="l00670"></a>00670         <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ed9bd80f048d611b1868618958facc363" title="Required argument was not supplied.">SO_ARG_MISSING</a>;
<a name="l00671"></a>00671         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="comment">// Shuffle arguments to the end of the argv array.</span>
<a name="l00675"></a>00675 <span class="comment">//</span>
<a name="l00676"></a>00676 <span class="comment">// For example:</span>
<a name="l00677"></a>00677 <span class="comment">//      argv[] = { "0", "1", "2", "3", "4", "5", "6", "7", "8" };</span>
<a name="l00678"></a>00678 <span class="comment">//</span>
<a name="l00679"></a>00679 <span class="comment">//  ShuffleArg(1, 1) = { "0", "2", "3", "4", "5", "6", "7", "8", "1" };</span>
<a name="l00680"></a>00680 <span class="comment">//  ShuffleArg(5, 2) = { "0", "1", "2", "3", "4", "7", "8", "5", "6" };</span>
<a name="l00681"></a>00681 <span class="comment">//  ShuffleArg(2, 4) = { "0", "1", "6", "7", "8", "2", "3", "4", "5" };</span>
<a name="l00682"></a>00682 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00683"></a>00683 <span class="keywordtype">void</span>
<a name="l00684"></a><a class="code" href="classCSimpleOptTempl.html#e839959a25abd98b1757d56991536418">00684</a> <a class="code" href="classCSimpleOptTempl.html#e839959a25abd98b1757d56991536418">CSimpleOptTempl&lt;SOCHAR&gt;::ShuffleArg</a>(
<a name="l00685"></a>00685                                                                         <span class="keywordtype">int</span> a_nStartIdx,
<a name="l00686"></a>00686                                                                         <span class="keywordtype">int</span> a_nCount
<a name="l00687"></a>00687                                                                         )
<a name="l00688"></a>00688 {
<a name="l00689"></a>00689         SOCHAR * buf[200];
<a name="l00690"></a>00690         <span class="keywordtype">int</span> n, nSrc, nDst;
<a name="l00691"></a>00691         <span class="keywordtype">int</span> nTail = <a class="code" href="classCSimpleOptTempl.html#806239dfc432f247fd0013479533d08c">m_argc</a> - a_nStartIdx - a_nCount;
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="comment">// make a copy of the elements to be moved</span>
<a name="l00694"></a>00694         nSrc = a_nStartIdx;
<a name="l00695"></a>00695         nDst = 0;
<a name="l00696"></a>00696         <span class="keywordflow">while</span> (nDst &lt; a_nCount) {
<a name="l00697"></a>00697                 buf[nDst++] = <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[nSrc++];
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="comment">// move the tail down</span>
<a name="l00701"></a>00701         nSrc = a_nStartIdx + a_nCount;
<a name="l00702"></a>00702         nDst = a_nStartIdx;
<a name="l00703"></a>00703         <span class="keywordflow">for</span> (n = 0; n &lt; nTail; ++n) {
<a name="l00704"></a>00704                 <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[nDst++] = <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[nSrc++];
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         <span class="comment">// append the moved elements to the tail</span>
<a name="l00708"></a>00708         nSrc = 0;
<a name="l00709"></a>00709         nDst = a_nStartIdx + nTail;
<a name="l00710"></a>00710         <span class="keywordflow">for</span> (n = 0; n &lt; a_nCount; ++n) {
<a name="l00711"></a>00711                 <a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[nDst++] = buf[nSrc++];
<a name="l00712"></a>00712         }
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         <span class="comment">// update the index of the last unshuffled arg</span>
<a name="l00715"></a>00715         <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a> -= a_nCount;
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="comment">// match on the long format strings. partial matches will be</span>
<a name="l00719"></a>00719 <span class="comment">// accepted only if that feature is enabled.</span>
<a name="l00720"></a>00720 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00721"></a>00721 <span class="keywordtype">int</span>
<a name="l00722"></a><a class="code" href="classCSimpleOptTempl.html#90380c291fd14816ac48d6d9f01deb60">00722</a> <a class="code" href="classCSimpleOptTempl.html#90380c291fd14816ac48d6d9f01deb60">CSimpleOptTempl&lt;SOCHAR&gt;::LookupOption</a>(
<a name="l00723"></a>00723                                                                           <span class="keyword">const</span> SOCHAR * a_pszOption
<a name="l00724"></a>00724                                                                           )<span class="keyword"> const</span>
<a name="l00725"></a>00725 <span class="keyword"></span>{
<a name="l00726"></a>00726         <span class="keywordtype">int</span> nBestMatch = -1;    <span class="comment">// index of best match so far</span>
<a name="l00727"></a>00727         <span class="keywordtype">int</span> nBestMatchLen = 0;  <span class="comment">// matching characters of best match</span>
<a name="l00728"></a>00728         <span class="keywordtype">int</span> nLastMatchLen = 0;  <span class="comment">// matching characters of last best match</span>
<a name="l00729"></a>00729 
<a name="l00730"></a>00730         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; <a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[n].<a class="code" href="structCSimpleOptTempl_1_1SOption.html#10837f04451fe178b47f1c956db23964" title="ID to return for this flag. Optional but must be &amp;gt;= 0.">nId</a> &gt;= 0; ++n) {
<a name="l00731"></a>00731                 <span class="comment">// the option table must use hyphens as the option character,</span>
<a name="l00732"></a>00732                 <span class="comment">// the slash character is converted to a hyphen for testing.</span>
<a name="l00733"></a>00733                 <a class="code" href="SimpleOpt_8h.html#ef04e770d2ff67119511cf3f134c8eaa" title="assertion used to test input data">SO_ASSERT</a>(<a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[n].pszArg[0] != (SOCHAR)<span class="charliteral">'/'</span>);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735                 <span class="keywordtype">int</span> nMatchLen = <a class="code" href="classCSimpleOptTempl.html#06e388266b7e1bd1cbcb08c276fc2cb1">CalcMatch</a>(<a class="code" href="classCSimpleOptTempl.html#ec0bb315861b05e5564f8552f7ec9c36">m_rgOptions</a>[n].pszArg, a_pszOption);
<a name="l00736"></a>00736                 <span class="keywordflow">if</span> (nMatchLen == -1) {
<a name="l00737"></a>00737                         <span class="keywordflow">return</span> n;
<a name="l00738"></a>00738                 }
<a name="l00739"></a>00739                 <span class="keywordflow">if</span> (nMatchLen &gt; 0 &amp;&amp; nMatchLen &gt;= nBestMatchLen) {
<a name="l00740"></a>00740                         nLastMatchLen = nBestMatchLen;
<a name="l00741"></a>00741                         nBestMatchLen = nMatchLen;
<a name="l00742"></a>00742                         nBestMatch = n;
<a name="l00743"></a>00743                 }
<a name="l00744"></a>00744         }
<a name="l00745"></a>00745 
<a name="l00746"></a>00746         <span class="comment">// only partial matches or no match gets to here, ensure that we</span>
<a name="l00747"></a>00747         <span class="comment">// don't return a partial match unless it is a clear winner</span>
<a name="l00748"></a>00748         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655ce9ea56fe015db577ffe3bb4574658db0">SO_O_EXACT</a>) || nBestMatch == -1) {
<a name="l00749"></a>00749                 <span class="keywordflow">return</span> <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e7cef1b6c4d9a8be0961964e254cc2d6b">SO_OPT_INVALID</a>;
<a name="l00750"></a>00750         }
<a name="l00751"></a>00751         <span class="keywordflow">return</span> (nBestMatchLen &gt; nLastMatchLen) ? nBestMatch : <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32e7a90d467d2a707e85e7229d5eb57a160">SO_OPT_MULTIPLE</a>;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="comment">// calculate the number of characters that match (case-sensitive)</span>
<a name="l00755"></a>00755 <span class="comment">// 0 = no match, &gt; 0 == number of characters, -1 == perfect match</span>
<a name="l00756"></a>00756 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00757"></a>00757 <span class="keywordtype">int</span>
<a name="l00758"></a><a class="code" href="classCSimpleOptTempl.html#06e388266b7e1bd1cbcb08c276fc2cb1">00758</a> <a class="code" href="classCSimpleOptTempl.html#06e388266b7e1bd1cbcb08c276fc2cb1">CSimpleOptTempl&lt;SOCHAR&gt;::CalcMatch</a>(
<a name="l00759"></a>00759                                                                    <span class="keyword">const</span> SOCHAR *  a_pszSource,
<a name="l00760"></a>00760                                                                    <span class="keyword">const</span> SOCHAR *  a_pszTest
<a name="l00761"></a>00761                                                                    )<span class="keyword"> const</span>
<a name="l00762"></a>00762 <span class="keyword"></span>{
<a name="l00763"></a>00763         <span class="keywordflow">if</span> (!a_pszSource || !a_pszTest) {
<a name="l00764"></a>00764                 <span class="keywordflow">return</span> 0;
<a name="l00765"></a>00765         }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767         <span class="comment">// match and skip leading hyphens</span>
<a name="l00768"></a>00768         <span class="keywordflow">while</span> (*a_pszSource == (SOCHAR)<span class="charliteral">'-'</span> &amp;&amp; *a_pszSource == *a_pszTest) {
<a name="l00769"></a>00769                 ++a_pszSource; ++a_pszTest;
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771         <span class="keywordflow">if</span> (*a_pszSource == (SOCHAR)<span class="charliteral">'-'</span> || *a_pszTest == (SOCHAR)<span class="charliteral">'-'</span>) {
<a name="l00772"></a>00772                 <span class="keywordflow">return</span> 0;
<a name="l00773"></a>00773         }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775         <span class="comment">// find matching number of characters in the strings</span>
<a name="l00776"></a>00776         <span class="keywordtype">int</span> nLen = 0;
<a name="l00777"></a>00777         <span class="keywordflow">while</span> (*a_pszSource &amp;&amp; *a_pszSource == *a_pszTest) {
<a name="l00778"></a>00778                 ++a_pszSource; ++a_pszTest; ++nLen;
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780 
<a name="l00781"></a>00781         <span class="comment">// if we have exhausted the source...</span>
<a name="l00782"></a>00782         <span class="keywordflow">if</span> (!*a_pszSource) {
<a name="l00783"></a>00783                 <span class="comment">// and the test strings, then it's a perfect match</span>
<a name="l00784"></a>00784                 <span class="keywordflow">if</span> (!*a_pszTest) {
<a name="l00785"></a>00785                         <span class="keywordflow">return</span> -1;
<a name="l00786"></a>00786                 }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788                 <span class="comment">// otherwise the match failed as the test is longer than</span>
<a name="l00789"></a>00789                 <span class="comment">// the source. i.e. "--mant" will not match the option "--man".</span>
<a name="l00790"></a>00790                 <span class="keywordflow">return</span> 0;
<a name="l00791"></a>00791         }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793         <span class="comment">// if we haven't exhausted the test string then it is not a match</span>
<a name="l00794"></a>00794         <span class="comment">// i.e. "--mantle" will not best-fit match to "--mandate" at all.</span>
<a name="l00795"></a>00795         <span class="keywordflow">if</span> (*a_pszTest) {
<a name="l00796"></a>00796                 <span class="keywordflow">return</span> 0;
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799         <span class="comment">// partial match to the current length of the test string</span>
<a name="l00800"></a>00800         <span class="keywordflow">return</span> nLen;
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 <span class="comment">// calculate the number of characters that match (case-sensitive)</span>
<a name="l00804"></a>00804 <span class="comment">// 0 = no match, &gt; 0 == number of characters, -1 == perfect match</span>
<a name="l00805"></a>00805 <span class="keyword">template</span>&lt;<span class="keyword">class</span> SOCHAR&gt;
<a name="l00806"></a>00806 SOCHAR **
<a name="l00807"></a><a class="code" href="classCSimpleOptTempl.html#d0ec3543a8272202a107ddbfee19a09d">00807</a> <a class="code" href="classCSimpleOptTempl.html#d0ec3543a8272202a107ddbfee19a09d" title="Validate and return the desired number of arguments.">CSimpleOptTempl&lt;SOCHAR&gt;::MultiArg</a>(
<a name="l00808"></a>00808                                                                   <span class="keywordtype">int</span> a_nCount
<a name="l00809"></a>00809                                                                   )
<a name="l00810"></a>00810 {
<a name="l00811"></a>00811         <span class="comment">// ensure we have enough arguments</span>
<a name="l00812"></a>00812         <span class="keywordflow">if</span> (<a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a> + a_nCount &gt; <a class="code" href="classCSimpleOptTempl.html#23220ed6560a7a4f5e8f04e3e3f76c41">m_nLastArg</a>) {
<a name="l00813"></a>00813                 <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32ed9bd80f048d611b1868618958facc363" title="Required argument was not supplied.">SO_ARG_MISSING</a>;
<a name="l00814"></a>00814                 <span class="keywordflow">return</span> NULL;
<a name="l00815"></a>00815         }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="comment">// our argument array</span>
<a name="l00818"></a>00818         SOCHAR ** rgpszArg = &amp;<a class="code" href="classCSimpleOptTempl.html#940edde88150fc326f6f7727616dcfbe">m_argv</a>[<a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a>];
<a name="l00819"></a>00819 
<a name="l00820"></a>00820         <span class="comment">// Ensure that each of the following don't start with an switch character.</span>
<a name="l00821"></a>00821         <span class="comment">// Only make this check if we are returning errors for unknown arguments.</span>
<a name="l00822"></a>00822         <span class="keywordflow">if</span> (!<a class="code" href="classCSimpleOptTempl.html#6d64a2ee929aa5442191614cfdc7f53f" title="Query if a particular flag is set.">HasFlag</a>(<a class="code" href="SimpleOpt_8h.html#109074059825d7854b1cbda2ae0e655c602621e24cc508e09dff311a58b9cb4c">SO_O_NOERR</a>)) {
<a name="l00823"></a>00823                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n = 0; n &lt; a_nCount; ++n) {
<a name="l00824"></a>00824                         SOCHAR ch = <a class="code" href="classCSimpleOptTempl.html#c43ee4c32540063ae644cbb215a17d0b">PrepareArg</a>(rgpszArg[n]);
<a name="l00825"></a>00825                         <span class="keywordflow">if</span> (rgpszArg[n][0] == (SOCHAR)<span class="charliteral">'-'</span>) {
<a name="l00826"></a>00826                                 rgpszArg[n][0] = ch;
<a name="l00827"></a>00827                                 <a class="code" href="classCSimpleOptTempl.html#a43383b56d754b45fe8ac1ead3cefeea">m_nLastError</a> = <a class="code" href="SimpleOpt_8h.html#9a98a08114825ad62afde60607e5c32efa64f2e31ca6b0ee334aa2c8d95fa2ed">SO_ARG_INVALID_DATA</a>;
<a name="l00828"></a>00828                                 <span class="keywordflow">return</span> NULL;
<a name="l00829"></a>00829                         }
<a name="l00830"></a>00830                         rgpszArg[n][0] = ch;
<a name="l00831"></a>00831                 }
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834         <span class="comment">// all good</span>
<a name="l00835"></a>00835         <a class="code" href="classCSimpleOptTempl.html#49374ac9af67f2f14291f90448c8e2e8">m_nNextOption</a> += a_nCount;
<a name="l00836"></a>00836         <span class="keywordflow">return</span> rgpszArg;
<a name="l00837"></a>00837 }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00841"></a>00841 <span class="comment">//                                  TYPE DEFINITIONS</span>
<a name="l00842"></a>00842 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00843"></a>00843 
<a name="l00844"></a><a class="code" href="SimpleOpt_8h.html#7e3e692e09fe7e68d751de7bfdcff0e0">00844</a> <span class="keyword">typedef</span> <a class="code" href="classCSimpleOptTempl.html" title="Implementation of the SimpleOpt class.">CSimpleOptTempl&lt;char&gt;</a>    <a class="code" href="classCSimpleOptTempl.html" title="Implementation of the SimpleOpt class.">CSimpleOptA</a>; 
<a name="l00845"></a><a class="code" href="SimpleOpt_8h.html#1429b2cd4258d668e3433649c9db5b75">00845</a> <span class="keyword">typedef</span> <a class="code" href="classCSimpleOptTempl.html" title="Implementation of the SimpleOpt class.">CSimpleOptTempl&lt;wchar_t&gt;</a> <a class="code" href="classCSimpleOptTempl.html" title="Implementation of the SimpleOpt class.">CSimpleOptW</a>; 
<a name="l00846"></a>00846 <span class="preprocessor">#if defined(_UNICODE)</span>
<a name="l00847"></a>00847 <span class="preprocessor"></span><span class="preprocessor"># define CSimpleOpt CSimpleOptW   </span>
<a name="l00848"></a>00848 <span class="preprocessor">#else</span>
<a name="l00849"></a><a class="code" href="SimpleOpt_8h.html#75b3d3daa3f7b4893be751eea4943b41">00849</a> <span class="preprocessor"></span><span class="preprocessor"># define CSimpleOpt CSimpleOptA   </span>
<a name="l00850"></a>00850 <span class="preprocessor">#endif</span>
<a name="l00851"></a>00851 <span class="preprocessor"></span>
<a name="l00852"></a>00852 <span class="preprocessor">#endif // INCLUDED_SimpleOpt</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Wed Dec 12 11:00:55 2007 for Rigs of Rods Multiplayer Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>

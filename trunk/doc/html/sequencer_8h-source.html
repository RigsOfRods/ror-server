<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>rorserver: dev/workspace/rorserver/sequencer.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>dev/workspace/rorserver/sequencer.h</h1><a href="sequencer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">This file is part of "Rigs of Rods Server" (Relay mode)</span>
<a name="l00003"></a>00003 <span class="comment">Copyright 2007 Pierre-Michel Ricordel</span>
<a name="l00004"></a>00004 <span class="comment">Contact: pricorde@rigsofrods.com</span>
<a name="l00005"></a>00005 <span class="comment">"Rigs of Rods Server" is distributed under the terms of the GNU General Public License.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">"Rigs of Rods Server" is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">the Free Software Foundation; version 3 of the License.</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">"Rigs of Rods Server" is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment">GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 <span class="preprocessor">#ifndef __Sequencer_H__</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span><span class="preprocessor">#define __Sequencer_H__</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span>
<a name="l00022"></a>00022 <span class="preprocessor">#include "SocketW.h"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "<a class="code" href="listener_8h.html">listener.h</a>"</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include "<a class="code" href="receiver_8h.html">receiver.h</a>"</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="broadcaster_8h.html">broadcaster.h</a>"</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include "<a class="code" href="notifier_8h.html">notifier.h</a>"</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include "<a class="code" href="Vector3_8h.html">Vector3.h</a>"</span>
<a name="l00028"></a>00028 <span class="keyword">class </span><a class="code" href="classBroadcaster.html" title="TODO: Documents the broadcaster class.">Broadcaster</a>;
<a name="l00029"></a>00029 <span class="keyword">class </span><a class="code" href="classReceiver.html">Receiver</a>;
<a name="l00030"></a>00030 <span class="keyword">class </span><a class="code" href="classListener.html">Listener</a>;
<a name="l00031"></a>00031 <span class="keyword">class </span><a class="code" href="classNotifier.html">Notifier</a>;
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="sequencer_8h.html#9a8e700d56e7d858108b755ad3edb52e">00033</a> <span class="preprocessor">#define FREE 0</span>
<a name="l00034"></a><a class="code" href="sequencer_8h.html#b5be0aaddb58ffb9cb20c12530d66316">00034</a> <span class="preprocessor"></span><span class="preprocessor">#define BUSY 1</span>
<a name="l00035"></a><a class="code" href="sequencer_8h.html#bcd0a22ee4346cad5706adb6d2119429">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define USED 2</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00038"></a><a class="code" href="structclient__t.html">00038</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00039"></a>00039 {
<a name="l00041"></a><a class="code" href="structclient__t.html#2f04416800c8118ff6771481ad096116">00041</a>         <span class="keywordtype">int</span> status;
<a name="l00043"></a><a class="code" href="structclient__t.html#78466dad63876ec4fca3fbf1e98f4f54">00043</a>         <a class="code" href="classReceiver.html">Receiver</a>* receiver;
<a name="l00045"></a><a class="code" href="structclient__t.html#14e3de5f7dc2ad9016f9047491405ee1">00045</a>         <a class="code" href="classBroadcaster.html" title="TODO: Documents the broadcaster class.">Broadcaster</a>* broadcaster;
<a name="l00047"></a><a class="code" href="structclient__t.html#6f8bf60953395700cc7a0f20c1799d0a">00047</a>         SWInetSocket* sock;
<a name="l00049"></a><a class="code" href="structclient__t.html#ba5cbbeaae38fb9a41e49b83b4e5c8f2">00049</a>         <span class="keywordtype">bool</span> flow;
<a name="l00051"></a><a class="code" href="structclient__t.html#c827b24aad54c0c2e119f9de8a88cbd5">00051</a>         <span class="keywordtype">char</span> vehicle_name[140];
<a name="l00053"></a><a class="code" href="structclient__t.html#1ef20a57a07eb8771ff18c8cc9b8d205">00053</a>         <span class="keywordtype">char</span> nickname[32];
<a name="l00055"></a><a class="code" href="structclient__t.html#c7e189a1e387bbdf9cb5f497b31f4f64">00055</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uid;
<a name="l00057"></a><a class="code" href="structclient__t.html#903827b6d0545da75a3b406040d8c4c6">00057</a>         <a class="code" href="classVector3.html">Vector3</a> position;
<a name="l00058"></a>00058 } <a class="code" href="structclient__t.html" title="A struct to hold information about a client.">client_t</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="classSequencer.html">00060</a> <span class="keyword">class </span><a class="code" href="classSequencer.html">Sequencer</a>
<a name="l00061"></a>00061 {
<a name="l00062"></a>00062 <span class="keyword">private</span>:
<a name="l00063"></a><a class="code" href="classSequencer.html#86fb6e1b5a83aaf671675103ddd39553">00063</a>         pthread_t <a class="code" href="classSequencer.html#86fb6e1b5a83aaf671675103ddd39553">killerthread</a>;
<a name="l00064"></a><a class="code" href="classSequencer.html#cb35cca4d1de9c9749f9002b6aa4f707">00064</a>         pthread_cond_t <a class="code" href="classSequencer.html#cb35cca4d1de9c9749f9002b6aa4f707">killer_cv</a>;
<a name="l00066"></a><a class="code" href="classSequencer.html#c8ad6695d0ba7a94c9c592cf68de111f">00066</a>         pthread_mutex_t <a class="code" href="classSequencer.html#c8ad6695d0ba7a94c9c592cf68de111f" title="mutex used for locking access to the killqueue">killer_mutex</a>;
<a name="l00068"></a><a class="code" href="classSequencer.html#92adcb10870d2c1c349552c704a3771a">00068</a>         pthread_mutex_t <a class="code" href="classSequencer.html#92adcb10870d2c1c349552c704a3771a" title="mutex used for locking access to the clients array">clients_mutex</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="classSequencer.html#64c9c62174b9ab4f89424d35f3b9968f">00070</a>         <a class="code" href="classListener.html">Listener</a> *<a class="code" href="classSequencer.html#64c9c62174b9ab4f89424d35f3b9968f">listener</a>;
<a name="l00074"></a><a class="code" href="classSequencer.html#348d368ea45ea311431a48131db461b1">00074</a>         <a class="code" href="structclient__t.html" title="A struct to hold information about a client.">client_t</a> *<a class="code" href="classSequencer.html#348d368ea45ea311431a48131db461b1" title="clients is a list of all the available client connections, it is allocated">clients</a>;
<a name="l00076"></a><a class="code" href="classSequencer.html#c8c123138536922bba919b610d64060e">00076</a>         <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#c8c123138536922bba919b610d64060e" title="maximum number of clients allowed to connect to the server.">maxclients</a>;
<a name="l00077"></a><a class="code" href="classSequencer.html#7ca5cc25526056d24cd7d204131d95fc">00077</a>         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#7ca5cc25526056d24cd7d204131d95fc">fuid</a>;
<a name="l00084"></a><a class="code" href="classSequencer.html#4a27c07a783ec3e333e71a4e0c74e89c">00084</a>         <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#4a27c07a783ec3e333e71a4e0c74e89c" title="killqueue is a queue of clients to be killed. killqueue is a queue of clients to...">killqueue</a>[256];
<a name="l00088"></a><a class="code" href="classSequencer.html#251a464606a05df596d944ac4578f61c">00088</a>         <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#251a464606a05df596d944ac4578f61c" title="freekillqueue holds the number of spots available in the killqueue">freekillqueue</a>;
<a name="l00089"></a><a class="code" href="classSequencer.html#a4420c5f821951b7b7dc6ff985801e1c">00089</a>         <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#a4420c5f821951b7b7dc6ff985801e1c">servermode</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="keyword">public</span>:
<a name="l00092"></a>00092         <a class="code" href="classSequencer.html#7bec7893a9950cf733b38a0000226412">Sequencer</a>(<span class="keywordtype">char</span> *pubip, <span class="keywordtype">int</span> listenport, <span class="keywordtype">char</span>* servname, <span class="keywordtype">char</span>* terrname, <span class="keywordtype">int</span> max_clients, <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#a4420c5f821951b7b7dc6ff985801e1c">servermode</a>, <span class="keywordtype">char</span> *password);
<a name="l00093"></a>00093         <a class="code" href="classSequencer.html#67acaec0a4ef53a7660e666081cdbe77">~Sequencer</a>(<span class="keywordtype">void</span>);
<a name="l00095"></a>00095         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#051601147f13fa1e4048fe43b2206856" title="initilize client information">createClient</a>(SWInetSocket *sock, <span class="keywordtype">char</span>* name);
<a name="l00097"></a>00097         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#4fb826c34117700c2c0bc7dd5db5272c" title="call to start the thread to disconnect clients from the server.">killerthreadstart</a>();
<a name="l00099"></a>00099         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#6d68200bac2b02042697355b5909a629" title="call to initiate the disconnect processes for a client.">disconnect</a>(<span class="keywordtype">int</span> pos, <span class="keywordtype">char</span>* error);
<a name="l00100"></a>00100         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#dadbd3f956276e1e2c8b58c4a9dbef8c">queueMessage</a>(<span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> type, <span class="keywordtype">char</span>* data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len);
<a name="l00101"></a>00101         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#b3d6d566fab94fb746b5a464b4da3fc1">enableFlow</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);
<a name="l00102"></a>00102         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#17ed9ace164a94ced5e7c571f4387997">notifyRoutine</a>();
<a name="l00103"></a>00103         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#7aae2ccbf7acaac3b6d22087dd846d41">notifyAllVehicles</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>);
<a name="l00105"></a>00105         <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#6afe8d4647dc1e71f1dc52fa594051df" title="returns the number of clients connected to this server">getNumClients</a>();
<a name="l00106"></a>00106         <span class="keywordtype">int</span> <a class="code" href="classSequencer.html#f0eef5ffbc028268fb66cb7fe49ac6b4">getHeartbeatData</a>(<span class="keywordtype">char</span> *challenge, <span class="keywordtype">char</span> *hearbeatdata);
<a name="l00108"></a>00108         <span class="keywordtype">void</span> <a class="code" href="classSequencer.html#2bed0b1f98d44407b3cda0081e76b038" title="prints the Stats view, of who is connected and what slot they are in">printStats</a>();
<a name="l00109"></a><a class="code" href="classSequencer.html#d8c2d8908feff4c4ca0363a8f0a9cb63">00109</a>         <a class="code" href="classNotifier.html">Notifier</a> *<a class="code" href="classSequencer.html#d8c2d8908feff4c4ca0363a8f0a9cb63">notifier</a>;
<a name="l00110"></a>00110 };
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Mon Dec 10 16:13:45 2007 for rorserver by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
